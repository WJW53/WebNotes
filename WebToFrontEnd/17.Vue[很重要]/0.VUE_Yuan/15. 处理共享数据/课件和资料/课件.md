# 数据管理

在实际的开发中，经常会遇到多个组件共享一个数据的场景

![](http://mdrs.yuanjin.tech/img/2020-02-19-16-46-28.png)

面对这种场景，会产生至少以下两个问题：

1. 多个组件如何共享同一份数据？
2. 如果某个组件修改了数据，如何让其他组件知道？

面对这种问题，一个可行的解决办法，就是让**数据提升**

所谓数据提升，就是把数据提升到更加顶层的组件，让顶层的组件通过属性下发数据，而当组件想改变数据的时候，又通过事件一层层向上传递

![|600](/Users/yuanjin/repo/集训营/6天上手vue/20200224/源码/5. 数据管理/assets/2020-02-19-16-55-13.png)

使用这种方式，虽然可以解决问题，但是带来了更多的问题：

1. 书写特别繁琐
2. 依赖极其混乱：某些组件本来并不需要一些数据，但是由于它的子组件需要，自己也必须要接收
3. 无谓的重新渲染：如果数据变化了，并不依赖这些数据的组件也会被迫重新渲染

为了解决这些问题，`vuex`出现了

`vuex`专门用于解决共享数据问题，它的思路和上述一致，也是将数据提升到顶层，不过它使用了一些特别的技巧，不仅让组件的依赖更加清晰，当数据变动时，仅渲染依赖该数据的组件

但是要**注意，并非所有数据都需要让`vuex`管理，通常vuex只管理那些需要被组件共享的数据**

> 在实际的开发中，一些逻辑特别复杂的数据，尽管不共享，也可能提取到vuex中进行管理

# 安装

## 安装vuex

在页面中引入`vuex`库

该库提供了一个构造函数`Vuex.Store`，通过该构造函数，即可创建一个数据仓库

```js
var store = new Vuex.Store({
  // 仓库数据配置
})
Vue.use(Vuex);
new Vue({
  // 其他配置
  store
})
```

## 安装vue devtools

这是一个chrome浏览器插件，用于调试vue、vue-router、vuex应用



# vuex的核心概念



1. 数据的改动

   必须要提交`commit`一个`mutation`

   在vuex中，提交`mutation`是数据变化的**唯一原因**

   在mutation中不能出现副作用操作

   什么是副作用操作：

   - 改动或使用外部的数据
   - ajax
   - 其他异步行为

2. 处理副作用

   触发`dispatch`一个`action`

# store变化逻辑

1. 直接通过`mutation`改动仓库数据

<img src="http://mdrs.yuanjin.tech/img/image-20200518124351876.png" alt="image-20200518124351876" style="zoom:50%;" />

2. 通过`actioin`改动仓库数据

<img src="http://mdrs.yuanjin.tech/img/image-20200518124611793.png" alt="image-20200518124611793" style="zoom:50%;" />

# 关系图

<img src="http://mdrs.yuanjin.tech/img/image-20200518124912592.png" alt="image-20200518124912592" style="zoom:50%;" />