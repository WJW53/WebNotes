# pnpm

- 目前的它的功能效率甚至已经超过了yarn了, 但是知名度、下载量没有yarn高

`经我测试,windows下,使用pnpm install 包,最多只能在4层目录下成功,难道是和我的环境变量有关?还是说pnpm就只能这样呢?因为它自己内部就有6层目录(优化的非常NB,方法很巧妙)`

> ps: 目前pnpm坑还没踩完,我在vscode中无法pnpm install 包,只能在PowerShell管理员中使用

pnpm是一种新起的包管理器，从npm的下载量看，目前还没有超过yarn，但它的实现方式值得主流包管理器学习，某些开发者极力推荐使用pnpm

从结果上来看，它具有以下优势：

1. 目前，安装效率高于npm和yarn的最新版
2. 极其简洁的node_modules目录
3. 避免了开发时使用间接依赖的问题
4. 能极大的降低磁盘空间的占用

## 安装和使用

全局安装pnpm

```shell
npm install -g pnpm
```

之后在使用时，只需要把npm替换为pnpm即可

如果要执行安装在本地的CLI，可以使用pnpx，它和 npx 的功能完全一样，唯一不同的是，在使用pnpx执行一个需要安装的命令时，会使用pnpm进行安装

> 比如`npx mocha` 执行本地的 `mocha`命令时，如果`mocha`没有安装，`则npx会自动的、临时的安装mocha，`安装好后，自动运行mocha命令


## pnpm原理(重点)

1. 同 yarn 和 npm 一样，pnpm 仍然使用缓存(它的缓存在它工程所在的盘的根目录下的某个文件夹里的某个文件夹)来保存已经安装过的包，以及使用 pnpm-lock.yaml 来记录详细的依赖版本

2. **不同于 yarn 和 npm(不同工程都从缓存处拷贝一次包到工程里,虽然缓存里只有一份,但工程里还各有一份啊)， pnpm 使用`符号链接和硬链接（可将它们想象成快捷方式,建立链接）的做法来在工程中放置依赖`，从而规避了从缓存中拷贝文件的时间，使得安装和卸载的速度更快`**

3. 由于使用了**符号链接和硬链接**，pnpm可以规避windows操作系统路径过长的问题，因此，它选择使用树形的依赖结果，有着几乎完美的依赖管理。也因为如此，项目中只能使用直接依赖，而不能使用间接依赖(npm,yarn可以使用,但这样是不好的)


## 注意事项

由于 pnpm 会改动 node_modules 目录结构，使得每个包只能使用直接依赖，而不能使用间接依赖，因此，如果使用 pnpm 安装的包中包含间接依赖，则会出现问题(**现在不会了，除非使用了绝对路径**)

由于 pnpm 超高的安装卸载效率，越来越多的包开始修正之前的间接依赖代码