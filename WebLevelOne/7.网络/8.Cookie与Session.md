# Cookie与Session


## Cookie

1. 如果我们用JS的变量来存数据,那么在页面关闭的时候,数据就消失了.
2. 保持登陆状态是怎么做到的呢?

按照正常的HTTP协议来说,是做不到的
因为`HTTP协议,是上下文无关协议: 就是,在不同的页面彼此不算数(比如登录)`

3. 所以说前端页面上,要有可持久化存储数据的东西,一旦登陆成功,我就记载在这个里面.

4. **Cookie是有限制的,Cookie是存在浏览器里的,不是存在某个页面里的,Cookie是可以长期存储的.Cookie即使是保存在浏览器里,也是存放在不同的域名下的**

    1). 初始状态：没有登陆
    2). 访问百度的登录,输入用户名、密码
    3). 如果用户名和密码是正确的. 百度的后端会向这个域名下,设置一个Cookie
写入用户的基本信息(这个是加密的).
    4). 以后每一次向浏览器发送请求,浏览器都会自动地带上这些Cookie
    5). 服务端(后端)看到了带有ID的Cookie,就可以解析这个加密的ID,来获取到这个用户本身的ID
    6). 如果能获取到本身的ID,那么就证明这个用户已经登录过了.所以后端可以继续保留用户的信息


- 缺点: 
    如果某个坏人,复制了我浏览器里的Cookie,他就可以在他的浏览器登录我的账号


## Session

**登录信息存在服务器端**,所以更安全,当然也有很多其他缺点,但也有其他的对应办法解决

- 缺点:
    如果用户量非常大,上亿的用户,服务器端是很耗资源的!!

因为后端可能不止一台服务器,而用户的登录信息,一般只存在一台服务器上.
因为用户的登陆操作,在哪台机器上执行的,就一般存在哪台机器上.

- 需要通过反向代理:
1. 轮询:    假设100台机器,第一个请求给第一台,2给2,...,缺点很大,没法用session直接实现
2. IP哈希:  因为我的IP不变,...相同的IP地址,会打在同一台服务器上(也有缺点和对应解决办法)


xss注入攻击 : 绝大多数都是获取Cookie,然后他们再伪造Cookie


## 缺点：
cookie：
               （1）大小受限

　　　　　　　　（2）用户可以操作（禁用）cookie，使功能受限

　　　　　　　　（3）安全性较低

　　　　　　　　（4）有些状态不可能保存在客户端。

　　　　　　　　（5）每次访问都要传送cookie给服务器，浪费带宽。

　　　　　　　　（6）cookie数据有路径（path）的概念，可以限制cookie只属于某个路径下。

session：
               （1）Session保存的东西越多，就越占用服务器内存，对于用户在线人数较多的网站，服务器的内存压力会比较大。

　　　　　　　　（2）依赖于cookie（sessionID保存在cookie），如果禁用cookie，则要使用URL重写，不安全

　　　　　　　　（3）创建Session变量有很大的随意性，可随时调用，不需要开发者做精确地处理，所以，过度使用session变量将会导致代码不可读而且不好维护。
